/*
* Copyright 2023 NXP
* All rights reserved.
*
* SPDX-License-Identifier: BSD-3-Clause
*/

#include <stdint.h>

#include "app_adc_shared.h"

#define NTC_
#define NTC_PD_RES 100000

/* Generated from https://www.sebulli.com/ntc/index.php */
/* Parameters: 256 points, 12bit ADC, pull-down resistor */
static const int s_ntc_interpolation_table[257] = {
    -564, -482, -400, -349, -310, -280, -254, -231, -211, -193, -177, -161, -147, -134, -122, -111, -100, -89,  -79,
    -70,  -60,  -52,  -43,  -35,  -27,  -19,  -12,  -5,   2,    9,    16,   23,   29,   35,   41,   47,   53,   59,
    65,   70,   76,   81,   86,   91,   97,   102,  107,  112,  116,  121,  126,  131,  135,  140,  144,  149,  153,
    158,  162,  166,  171,  175,  179,  183,  187,  192,  196,  200,  204,  208,  212,  216,  220,  223,  227,  231,
    235,  239,  243,  246,  250,  254,  258,  261,  265,  269,  273,  276,  280,  283,  287,  291,  294,  298,  302,
    305,  309,  312,  316,  319,  323,  327,  330,  334,  337,  341,  344,  348,  351,  355,  358,  362,  366,  369,
    373,  376,  380,  383,  387,  390,  394,  398,  401,  405,  408,  412,  415,  419,  423,  426,  430,  434,  437,
    441,  445,  448,  452,  456,  459,  463,  467,  471,  474,  478,  482,  486,  490,  493,  497,  501,  505,  509,
    513,  517,  521,  525,  529,  533,  537,  541,  545,  550,  554,  558,  562,  567,  571,  575,  580,  584,  589,
    593,  598,  602,  607,  612,  616,  621,  626,  631,  636,  641,  646,  651,  656,  661,  666,  672,  677,  682,
    688,  694,  699,  705,  711,  717,  723,  729,  735,  741,  748,  754,  761,  767,  774,  781,  788,  796,  803,
    811,  818,  826,  834,  842,  851,  859,  868,  877,  887,  896,  906,  916,  926,  937,  948,  960,  972,  984,
    997,  1010, 1024, 1038, 1053, 1069, 1085, 1102, 1121, 1140, 1161, 1182, 1206, 1231, 1258, 1287, 1319, 1354, 1393,
    1437, 1488, 1546, 1615, 1699, 1807, 1954, 2179, 2625, 3071,
};

/**
 * @brief Get current NTC temperature
 *
 * @return int NTC temperature (1/10th degree)
 */
int app_ntc_read(void) {
    int      p1, p2;
    uint32_t adc_value = app_adc_shared_get_result(APP_ADC_SHARED_CH_NTC);

    /* LUT */
    p1 = s_ntc_interpolation_table[(adc_value >> 4)];
    p2 = s_ntc_interpolation_table[(adc_value >> 4) + 1];

    /* Linear interpolation */
    return p1 + ((p2 - p1) * (adc_value & 0x000F)) / 16;
}